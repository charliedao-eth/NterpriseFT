---
title: "World of Women MVP"
author: "CharlieDAO NterpriseFT"
output: html_document
---

```{r include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
# prepare env
library(dplyr)
library(reshape)
library(ggplot2)
library(hash)

# loading helper functions
helperFunctionPath <- ('functions/helper_functions/')
sapply(list.files(pattern='[.]R$', path=helperFunctionPath, full.names=TRUE), source)

visualsFunctionsPath <- ('functions/visuals_functions/')
sapply(list.files(pattern='[.]R$', path=visualsFunctionsPath, full.names=TRUE), source)
```

```{r include=FALSE}
# load data
getLatestDataFromGithub()
```

# Update These Values

```{r include=FALSE}
nftName = 'World of Women'
twitterHistory = wow_history
twitterRawPrimary = wow_tweets_primary
twitterRawAll = wow_tweets_all
twitterUserId = '1414218489276125185'
```

# Summary Page

-   Social Cards

    -   New Twitter SIdeBar Followers This For Week
    -   Number of Tweets Made
    -   Likes, Retweets, Replies

-   Sales Cards

    -   Number of Sales
    -   Median Sales Price
    -   Rolling Median Sales Price

-   Ownsership Cards

    -   Number of New Owners
    -   Gini Coefficient of Holders
    -   Max, Avg, Median Number Held

-   Executive Summary (Parameterized Paragraph)

Twitter growth was [ABOVE \| BELOW] expected this. There are [\#\#] new followers while [ \#\# ] new followers was expected. Total engagement was [UP \| DOWN] [ %] week over week. The median sales price is [UP \| DOWN] to [\#\#] ETH. With [\#\#] sales this week, Volume is [UP \| DOWN] [%] week over week.

The \# of unique holders is [UP\|DOWN] week over week. The inequality of \# of NFTs owned is [UP \| DOWN] week over week. Your NFT is primarily held alongside [\#1 Competitor] [\#2 competitor][\#3 competitor].

Gas fees averaged [\#\#] gwei over the past week, and sales [OVER \| UNDER]performed relative to gas with [\#\#] sales versus expected [\#\#] given gas fees.

# Social Stats

1.  Twitter Followers over time

    ```{r echo=FALSE}
    createNftTimeSeriesPlot(
      dataframe=twitterHistory,
      dateCol='date',
      outcomeCols='followers',
      nftName=nftName,
      title='Twitter Followers Over Time',
      lowerQuantile=0.00,
      upperQuantile=1.00,
      imputeData=TRUE,
      geomLine=TRUE,
      logScale=FALSE,
      savePlotData=FALSE
    )
    ```

2.  DELTA Twitter Followers over time (vs expected)

3.  Likes/RTs over time

    ```{r echo=FALSE}
    twitterRawPrimarySummary <- twitterRawPrimary %>%
      mutate(date = as.Date(primary_tweets.created_at)) %>%
      group_by(date) %>%
      summarise(
        totalLikes = sum(primary_tweets.favorite_count),
        totalRetweets = sum(primary_tweets.retweet_count)
      )

    createNftTimeSeriesPlot(
      dataframe=twitterRawPrimarySummary,
      dateCol='date',
      outcomeCols=c('totalLikes', 'totalRetweets'),
      nftName=nftName,
      title='Twitter Engagement Over Time',
      lowerQuantile=0.00,
      upperQuantile=1.00,
      imputeData=TRUE,
      geomLine=TRUE,
      logScale=FALSE,
      savePlotData=FALSE
    )
    ```

4.  Engagement Score over time

    ```{r echo=FALSE}
    twitterMedianEngagementScore <- twitterRawPrimary %>%
      mutate(date = as.Date(primary_tweets.created_at)) %>%
      mutate(
        engagementScore = (1+primary_tweets.favorite_count)*(1+primary_tweets.retweet_count)
        ) %>%
      group_by(date) %>%
      summarise(
        medianEngagementScore = median(engagementScore),
      )

    createNftTimeSeriesPlot(
      dataframe=twitterMedianEngagementScore,
      dateCol='date',
      outcomeCols='medianEngagementScore',
      nftName=nftName,
      title='Median Engagement Score Over Time',
      lowerQuantile=0.00,
      upperQuantile=1.00,
      imputeData=TRUE,
      geomLine=TRUE,
      logScale=FALSE,
      savePlotData=FALSE
    )
    ```

5.  Tweets from main account

    -   Top 5 Tweets of the week

    -   Top 5 Tweets All time

    ```{r include=FALSE}
    # prepare twitter data
    twitterRawAllFilter <- twitterRawAll %>%
      filter(
        all_tweets.user_id == twitterUserId,
        all_tweets.is_retweet == FALSE,
      ) %>%
      mutate(
        engagementScore = (all_tweets.favorite_count+1)*(all_tweets.retweet_count+1)
      ) %>%
      mutate(
        timestamp = as.POSIXct(all_tweets.created_at, format="%Y-%m-%d %H:%M:%S", tz="UTC")
      ) %>%
      dplyr::rename(
        screenName = all_tweets.screen_name,
        tweetUrl = all_tweets.status_url,
        favoriteCount = all_tweets.favorite_count,
        retweetCount = all_tweets.retweet_count
      ) %>%
      select(
        screenName,
        timestamp,
        tweetUrl,
        favoriteCount,
        retweetCount,
        engagementScore
      )

    # get timeframes
    maxDate <- max(as.Date(twitterRawAllFilter$timestamp))
    weekStartDate <- maxDate - as.difftime(7, unit='days')
    ```

    ```{r echo=FALSE}
    # top 5 all time
    topFiveTweetsAll <- twitterRawAllFilter %>%
      arrange(desc(engagementScore)) %>%
      top_n(5)
    print(topFiveTweetsAll)

    # top 5 past week
    topFiveTweetsWeek <- twitterRawAllFilter %>%
      filter(between(as.Date(timestamp), weekStartDate, maxDate)) %>%
      arrange(desc(engagementScore)) %>%
      top_n(5)
    print(topFiveTweetsWeek)
    ```

6.  Tweets of others (out of scope for MVP)

    -   Top 5 Account that's retweeted the main NFT account the most all time

    -   Top 5 Accounts with the highest engagement all time for their retweets

    -   Top 5 retweets for the week between interquartile range Q2 and Q3 for engagement score (i.e. these are the tweets that were probably missed by the main account, but have solid reach with more room to grow; great for the main account to engage with).

# Sales Stats (exclude outlier sales)

1.  Rolling median sales price
2.  Sales table
3.  Volume of slaes over time
4.  daily volume and avg gas cost (gwei) per date
5.  any other sales graphs

# Ownership Stats

1.  Number owned boxplot
2.  Top owners table with wallet id and number owned
3.  Number of unique holders over time (derived from sales and transfers)
4.  Gini coefficient over time
5.  NFT Co-occurance in wallets (network)
